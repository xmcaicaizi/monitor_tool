<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>服务监控工具</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>服务监控工具</h1>
            <div class="header-buttons">
                <button @click="checkAllServices" class="btn btn-primary">一键检测所有服务</button>
                <div class="daily-check-controls">
                    <input type="time" v-model="dailyCheckTime" value="09:00">
                    <button @click="scheduleDailyCheck" class="btn btn-secondary">设置每日检查</button>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button @click="showAddForm = true" class="btn btn-success">添加服务</button>
        </div>
        
        <div v-if="showAddForm" class="modal">
            <div class="modal-content">
                <span class="close" @click="showAddForm = false">&times;</span>
                <h2>添加新服务</h2>
                <form @submit.prevent="addService">
                    <div class="form-group">
                        <label for="name">服务名称:</label>
                        <input type="text" id="name" v-model="newService.name" required>
                    </div>
                    <div class="form-group">
                        <label for="url">服务地址:</label>
                        <input type="url" id="url" v-model="newService.url" required>
                    </div>
                    <div class="form-group">
                        <label for="method">请求方法:</label>
                        <select id="method" v-model="newService.method">
                            <option value="GET">GET</option>
                            <option value="POST">POST (JSON)</option>
                            <option value="POST_FILE">POST (文件上传)</option>
                        </select>
                    </div>
                    <div v-if="newService.method === 'POST'" class="form-group">
                        <label for="body">请求体 (JSON):</label>
                        <textarea id="body" v-model="newService.body" rows="4" placeholder='{"key": "value"}'></textarea>
                    </div>
                    <div v-if="newService.method === 'POST_FILE'" class="form-group">
                        <label for="file-field">文件字段名:</label>
                        <input type="text" id="file-field" v-model="newService.fileFieldName" placeholder="file" value="file">
                        <label for="test-file">测试文件路径 (可选):</label>
                        <input type="text" id="test-file" v-model="newService.testFilePath" placeholder="留空使用默认测试内容">
                    </div>
                    <div class="form-group">
                        <label for="interval">检测间隔:</label>
                        <div class="interval-inputs">
                            <input type="number" v-model="newService.intervalValue" min="1" value="1">
                            <select v-model="newService.intervalUnit">
                                <option value="minute">分钟</option>
                                <option value="second">秒</option>
                                <option value="hour">小时</option>
                                <option value="day">天</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="auth-type">认证类型:</label>
                        <select id="auth-type" v-model="newService.authType">
                            <option value="">无认证</option>
                            <option value="bearer">Bearer Token</option>
                            <option value="header">自定义Header</option>
                            <option value="query">Query参数</option>
                        </select>
                    </div>
                    <div v-if="newService.authType" class="form-group">
                        <label for="auth-key">{{ getAuthKeyLabel(newService.authType) }}:</label>
                        <input type="text" id="auth-key" v-model="newService.authKey" :placeholder="getAuthKeyPlaceholder(newService.authType)">
                    </div>
                    <div v-if="newService.authType" class="form-group">
                        <label for="auth-value">认证值:</label>
                        <input type="password" id="auth-value" v-model="newService.authValue" placeholder="请输入认证值">
                    </div>
                    <button type="submit" class="btn btn-success">添加</button>
                </form>
            </div>
        </div>
        
        <div class="services-container">
            <div v-for="service in services" :key="service.id" class="service-card" :class="service.status">
                <div class="card-header">
                    <h3>{{ service.name }}</h3>
                    <span class="status-badge" :class="service.status">{{ getStatusText(service.status) }}</span>
                </div>
                <div class="card-body">
                    <p><strong>地址:</strong> {{ service.url }}</p>
                    <p><strong>请求方法:</strong> {{ service.method || 'GET' }}</p>
                    <p><strong>检测间隔:</strong> {{ formatInterval(service.interval) }}</p>
                    <p><strong>最后检测:</strong> {{ formatDateTime(service.lastChecked) }}</p>
                </div>
                <div class="card-footer">
                    <button @click="checkService(service.id)" class="btn btn-secondary">立即检测</button>
                    <button @click="openEditForm(service)" class="btn btn-warning">编辑</button>
                    <button @click="deleteService(service.id)" class="btn btn-danger">删除</button>
                </div>
            </div>
        </div>
        
        <!-- Edit Service Modal -->
        <div v-if="showEditForm" class="modal">
            <div class="modal-content">
                <span class="close" @click="showEditForm = false">&times;</span>
                <h2>编辑服务</h2>
                <form @submit.prevent="updateService">
                    <div class="form-group">
                        <label for="edit-name">服务名称:</label>
                        <input type="text" id="edit-name" v-model="editService.name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-url">服务地址:</label>
                        <input type="url" id="edit-url" v-model="editService.url" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-method">请求方法:</label>
                        <select id="edit-method" v-model="editService.method">
                            <option value="GET">GET</option>
                            <option value="POST">POST (JSON)</option>
                            <option value="POST_FILE">POST (文件上传)</option>
                        </select>
                    </div>
                    <div v-if="editService.method === 'POST'" class="form-group">
                        <label for="edit-body">请求体 (JSON):</label>
                        <textarea id="edit-body" v-model="editService.body" rows="4" placeholder='{"key": "value"}'></textarea>
                    </div>
                    <div v-if="editService.method === 'POST_FILE'" class="form-group">
                        <label for="edit-file-field">文件字段名:</label>
                        <input type="text" id="edit-file-field" v-model="editService.fileFieldName" placeholder="file">
                        <label for="edit-test-file">测试文件路径 (可选):</label>
                        <input type="text" id="edit-test-file" v-model="editService.testFilePath" placeholder="留空使用默认测试内容">
                    </div>
                    <div class="form-group">
                        <label for="edit-interval">检测间隔:</label>
                        <div class="interval-inputs">
                            <input type="number" id="edit-interval" v-model="editService.intervalValue" min="1" required>
                            <select v-model="editService.intervalUnit">
                                <option value="minute">分钟</option>
                                <option value="second">秒</option>
                                <option value="hour">小时</option>
                                <option value="day">天</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-auth-type">认证类型:</label>
                        <select id="edit-auth-type" v-model="editService.authType">
                            <option value="">无认证</option>
                            <option value="bearer">Bearer Token</option>
                            <option value="header">自定义Header</option>
                            <option value="query">Query参数</option>
                        </select>
                    </div>
                    <div v-if="editService.authType" class="form-group">
                        <label for="edit-auth-key">{{ getAuthKeyLabel(editService.authType) }}:</label>
                        <input type="text" id="edit-auth-key" v-model="editService.authKey" :placeholder="getAuthKeyPlaceholder(editService.authType)">
                    </div>
                    <div v-if="editService.authType" class="form-group">
                        <label for="edit-auth-value">认证值:</label>
                        <input type="password" id="edit-auth-value" v-model="editService.authValue" placeholder="请输入认证值">
                    </div>
                    <button type="submit" class="btn btn-success">更新</button>
                </form>
            </div>
        </div>
    </div>
    
    <script src="/js/app.js"></script>
</body>
</html>
